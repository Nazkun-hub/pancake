# PancakeSwap V3 æµåŠ¨æ€§ç®¡ç†ç³»ç»Ÿ

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

PancakeSwap V3 è‡ªåŠ¨åŒ–æµåŠ¨æ€§ç®¡ç†ç³»ç»Ÿï¼Œé›†æˆOKX DEX APIäº¤æ¢åŠŸèƒ½ï¼Œæ”¯æŒç­–ç•¥åŒ–æµåŠ¨æ€§ç®¡ç†ã€‚é‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œæ”¯æŒçœŸå®äº¤æ˜“å’Œæ¨¡æ‹Ÿäº¤æ˜“ä¸¤ç§æ¨¡å¼ã€‚

## ğŸŒ ç³»ç»Ÿæ¶æ„ä¸ç«¯å£é…ç½®

### ğŸ—ï¸ æœåŠ¡æ¶æ„å›¾
```
ç­–ç•¥å¼•æ“ â†’ 8000ç«¯å£ â†’ OKX DEX APIæœåŠ¡ (çœŸå®äº¤æ˜“)
ç­–ç•¥å¼•æ“ â†’ 8001ç«¯å£ â†’ OKXä»£ç†æœåŠ¡ â†’ è½¬å‘åˆ°4000ç«¯å£ â†’ ä¸»ç³»ç»ŸOKXè·¯ç”± (æ¨¡æ‹Ÿäº¤æ˜“)
```

### ğŸ“Š ç«¯å£åˆ†é…ç­–ç•¥
```
ğŸ  ä¸»ç¨‹åºç³»ç»Ÿ (4xxxç«¯å£)
â”œâ”€â”€ 4000 - ä¸»ç¨‹åºåç«¯API (æ ¸å¿ƒæœåŠ¡)
â”‚   â”œâ”€â”€ æµåŠ¨æ€§ç®¡ç† API
â”‚   â”œâ”€â”€ å¤´å¯¸ç®¡ç† API  
â”‚   â”œâ”€â”€ é’±åŒ…ç®¡ç† API
â”‚   â”œâ”€â”€ ç­–ç•¥æ‰§è¡Œ API
â”‚   â””â”€â”€ OKXè·¯ç”±é›†æˆ (/api/okx/*)
â””â”€â”€ 4001 - ä¸»ç¨‹åºå‰ç«¯ç•Œé¢

ğŸ“Š ç­–ç•¥ç®¡ç†ç³»ç»Ÿ (5xxxç«¯å£)  
â””â”€â”€ 5000 - ç­–ç•¥ç®¡ç†å‰ç«¯ç•Œé¢

ğŸ® OKXç³»ç»Ÿ (8xxxç«¯å£) - **é‡è¦ï¼šä¸¤ç§ä¸åŒçš„äº¤æ˜“æ¨¡å¼**
â”œâ”€â”€ 8000 - ğŸ”¥ OKX DEX APIæœåŠ¡ (çœŸå®åŒºå—é“¾äº¤æ˜“)
â”‚   â”œâ”€â”€ ç‹¬ç«‹Webç•Œé¢å’ŒAPIæœåŠ¡
â”‚   â”œâ”€â”€ ç›´æ¥BSCåŒºå—é“¾äº¤äº’
â”‚   â”œâ”€â”€ å†…ç½®æˆæƒå¤„ç† (è‡ªåŠ¨æ£€æŸ¥å’Œæ‰§è¡Œä»£å¸æˆæƒ)
â”‚   â”œâ”€â”€ çœŸå®äº¤æ˜“æ‰§è¡Œ (Web3ç›´æ¥å¹¿æ’­åˆ°BSCç½‘ç»œ)
â”‚   â”œâ”€â”€ å®Œæ•´çš„ç”¨æˆ·ç•Œé¢
â”‚   â””â”€â”€ ğŸ¯ ç­–ç•¥å¼•æ“ä½¿ç”¨æ­¤ç«¯å£è¿›è¡ŒçœŸå®äº¤æ˜“
â””â”€â”€ 8001 - ğŸ”„ OKXäº¤æ¢ä»£ç†æœåŠ¡ (æ¨¡æ‹Ÿäº¤æ˜“æ¨¡å¼)
    â”œâ”€â”€ é€æ˜è½¬å‘åˆ°ä¸»ç³»ç»Ÿ4000ç«¯å£
    â”œâ”€â”€ ä¸»è¦ç”¨äºæ¨¡æ‹Ÿå’Œæµ‹è¯•
    â”œâ”€â”€ éœ€è¦æ‰‹åŠ¨æˆæƒæ­¥éª¤
    â”œâ”€â”€ ç‹¬ç«‹å¥åº·æ£€æŸ¥
    â”œâ”€â”€ è¯·æ±‚æ—¥å¿—è®°å½•
    â””â”€â”€ æ¶æ„è§£è€¦è®¾è®¡
```

### ğŸ¯ **ç­–ç•¥å¼•æ“äº¤æ˜“æ¨¡å¼è¯´æ˜**

**å½“å‰ç­–ç•¥å¼•æ“ä½¿ç”¨ 8000ç«¯å£ è¿›è¡ŒçœŸå®äº¤æ˜“ï¼š**

```typescript
// ExecutionStages.ts ä¸­çš„å®ç°
const response = await fetch('http://localhost:8000/api/swap', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    fromTokenAddress,
    toTokenAddress,
    amount,
    userWalletAddress,
    chainId: '56', // BSCé“¾
    slippage: slippage.toString()
  })
});
```

**ä¼˜åŠ¿ï¼š**
- âœ… **çœŸå®åŒºå—é“¾äº¤æ˜“** - æ‰€æœ‰äº¤æ¢éƒ½åœ¨BSCé“¾ä¸Šæ‰§è¡Œ
- âœ… **å†…ç½®æˆæƒå¤„ç†** - æ— éœ€æ‰‹åŠ¨æˆæƒï¼Œè‡ªåŠ¨æ£€æŸ¥å’Œæ‰§è¡Œ
- âœ… **æ™ºèƒ½å›é€€æœºåˆ¶** - çœŸå®äº¤æ˜“å¤±è´¥æ—¶è‡ªåŠ¨å›é€€åˆ°æ¨¡æ‹Ÿäº¤æ˜“
- âœ… **å®Œæ•´è®°å½•** - æ‰€æœ‰äº¤æ˜“éƒ½æœ‰çœŸå®çš„äº¤æ˜“å“ˆå¸Œå¯æŸ¥

## ğŸ”¥ **8000ç«¯å£ vs 8001ç«¯å£ è¯¦ç»†å¯¹æ¯”**

### ğŸ® **8000ç«¯å£ï¼šOKX DEX API ç‹¬ç«‹æœåŠ¡ (çœŸå®äº¤æ˜“)**

**å¯åŠ¨æ–¹å¼**ï¼š`cd okx_dex_api && npm run web`
**æœåŠ¡æ–‡ä»¶**ï¼š`okx_dex_api/src/web/server.ts`

#### ç‰¹æ€§ï¼š
- âœ… **ç‹¬ç«‹çš„OKX DEXæœåŠ¡** - å®Œæ•´çš„Webç•Œé¢å’ŒAPI
- âœ… **ç›´æ¥åŒºå—é“¾äº¤äº’** - ä½¿ç”¨Web3ç›´æ¥ä¸BSCé“¾äº¤äº’
- âœ… **å†…ç½®æˆæƒå¤„ç†** - è‡ªåŠ¨æ£€æŸ¥å’Œæ‰§è¡Œä»£å¸æˆæƒ
- âœ… **çœŸå®äº¤æ˜“æ‰§è¡Œ** - ç›´æ¥å¹¿æ’­äº¤æ˜“åˆ°BSCç½‘ç»œ
- âœ… **å®Œæ•´çš„ç”¨æˆ·ç•Œé¢** - åŒ…å«Webå‰ç«¯é¡µé¢
- âœ… **ç‹¬ç«‹é…ç½®ç®¡ç†** - ç‹¬ç«‹çš„é’±åŒ…å’ŒAPIé…ç½®

#### ä¸»è¦APIç«¯ç‚¹ï¼š
```typescript
POST /api/config          - è®¾ç½®BSCé’±åŒ…é…ç½®
GET  /api/account         - è·å–BSCè´¦æˆ·ä¿¡æ¯  
GET  /api/tokens          - è·å–BSCæ”¯æŒçš„ä»£å¸
POST /api/quote           - è·å–BSCäº¤æ˜“æŠ¥ä»·
POST /api/approve         - æ‰§è¡Œä»£å¸æˆæƒ
POST /api/swap            - æ‰§è¡ŒBSCäº¤æ¢ (çœŸå®äº¤æ˜“ï¼Œå†…ç½®æˆæƒ)
GET  /api/track/:orderId  - è¿½è¸ªBSCäº¤æ˜“
```

### ğŸ”„ **8001ç«¯å£ï¼šOKXäº¤æ¢ä»£ç†æœåŠ¡ (æ¨¡æ‹Ÿäº¤æ˜“)**

**å¯åŠ¨æ–¹å¼**ï¼š`cd okx-proxy && npm start`
**æœåŠ¡æ–‡ä»¶**ï¼š`okx-proxy/proxy-server.js`

#### ç‰¹æ€§ï¼š
- ğŸ”„ **ä»£ç†è½¬å‘æœåŠ¡** - å°†è¯·æ±‚è½¬å‘åˆ°ä¸»ç¨‹åº4000ç«¯å£
- ğŸ”„ **APIæ ¼å¼å…¼å®¹** - æä¾›å…¼å®¹çš„APIæ¥å£æ ¼å¼
- ğŸ”„ **æ¨¡æ‹Ÿäº¤æ˜“æ¨¡å¼** - ä¸»è¦ç”¨äºæ¨¡æ‹Ÿå’Œæµ‹è¯•
- ğŸ”„ **æ— ç‹¬ç«‹ç•Œé¢** - çº¯APIä»£ç†æœåŠ¡
- ğŸ”„ **ä¾èµ–ä¸»ç¨‹åº** - éœ€è¦ä¸»ç¨‹åº4000ç«¯å£è¿è¡Œ
- ğŸ”„ **æ‰‹åŠ¨æˆæƒæ­¥éª¤** - éœ€è¦åˆ†æ­¥æ‰§è¡Œæˆæƒå’Œäº¤æ¢

#### ä»£ç†è·¯ç”±ï¼š
```javascript
GET  /api/okx/health   â†’ http://localhost:4000/api/okx/health
POST /api/okx/quote    â†’ http://localhost:4000/api/okx/quote  
POST /api/okx/approve  â†’ http://localhost:4000/api/okx/approve
POST /api/okx/swap     â†’ http://localhost:4000/api/okx/swap
GET  /api/okx/track/*  â†’ http://localhost:4000/api/okx/track/*
```

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### æ–¹å¼ä¸€ï¼šä¸€é”®å¯åŠ¨ (æ¨è)

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ (åŒ…æ‹¬æ–°çš„OKXä»£ç†æœåŠ¡)
./scripts/simple-start.sh

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
./scripts/check-ports.sh

# åœæ­¢æ‰€æœ‰æœåŠ¡
./scripts/stop-all-services.sh
```

**å¯åŠ¨è¾“å‡ºç¤ºä¾‹:**
```
ğŸš€ PancakeSwap V3 ç®€åŒ–å¯åŠ¨å™¨
===========================
ğŸš€ 1. å¯åŠ¨ä¸»ç¨‹åºåç«¯æœåŠ¡...
âœ… ä¸»ç¨‹åºåç«¯å·²å¯åŠ¨ (PID: 12345)
ğŸš€ 2. å¯åŠ¨OKXäº¤æ¢ä»£ç†æœåŠ¡...
âœ… OKXäº¤æ¢ä»£ç†å·²å¯åŠ¨ (PID: 12346)
ğŸš€ 3. æ£€æŸ¥ä¸»ç¨‹åºå‰ç«¯...
âœ… ä¸»ç¨‹åºå‰ç«¯å·²å¯åŠ¨ (PID: 12347)
ğŸš€ 4. æ£€æŸ¥ç­–ç•¥ç®¡ç†å‰ç«¯...
âœ… ç­–ç•¥ç®¡ç†å‰ç«¯å·²å¯åŠ¨ (PID: 12348)
ğŸš€ 5. æ£€æŸ¥OKX DEX APIæœåŠ¡...
âœ… OKX DEX APIå·²å¯åŠ¨ (PID: 12349)

ğŸ‰ å¯åŠ¨å®Œæˆï¼
=======================
âœ… ä¸»ç¨‹åºåç«¯ (4000) è¿è¡Œæ­£å¸¸
âœ… OKXäº¤æ¢ä»£ç† (8001) è¿è¡Œæ­£å¸¸
âœ… ç«¯å£ 4001 å·²ç›‘å¬
âœ… ç«¯å£ 5000 å·²ç›‘å¬
âœ… ç«¯å£ 8000 å·²ç›‘å¬
```

### æ–¹å¼äºŒï¼šåˆ†æ­¥å¯åŠ¨

```bash
# 1. å¯åŠ¨ä¸»ç¨‹åºåç«¯ (å¿…é¡»å…ˆå¯åŠ¨)
npm run dev

# 2. å¯åŠ¨OKXäº¤æ¢ä»£ç†æœåŠ¡ (ç­–ç•¥åŠŸèƒ½éœ€è¦)
cd okx-proxy && npm start

# 3. å¯åŠ¨ä¸»ç¨‹åºå‰ç«¯
cd web && npm start

# 4. å¯åŠ¨ç­–ç•¥ç®¡ç†å‰ç«¯
cd strategy-ui && npm start

# 5. å¯åŠ¨OKX DEX API (å¯é€‰)
cd okx_dex_api && npm run web
```

## ğŸŒ è®¿é—®åœ°å€

### ç”¨æˆ·ç•Œé¢
- ğŸ  **ä¸»ç¨‹åºå‰ç«¯**: http://localhost:4001
- ğŸ“Š **ç­–ç•¥ç®¡ç†ç•Œé¢**: http://localhost:5000
- ğŸ® **OKX DEX API**: http://localhost:8000

### APIæ¥å£
- ğŸ“¡ **ä¸»ç¨‹åºAPI**: http://localhost:4000/api
- ğŸ”„ **OKXäº¤æ¢ä»£ç†**: http://localhost:8001/api/okx
- ğŸ” **ç³»ç»Ÿå¥åº·æ£€æŸ¥**: http://localhost:4000/health
- ğŸ” **ä»£ç†å¥åº·æ£€æŸ¥**: http://localhost:8001/health

### WebSocketæœåŠ¡
- ğŸ“¡ **å®æ—¶æ•°æ®æ¨é€**: ws://localhost:4000

## ğŸ”§ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… PancakeSwap V3 æµåŠ¨æ€§ç®¡ç†
- âœ… è‡ªåŠ¨åŒ–ç­–ç•¥å¼•æ“
- âœ… OKX DEX ä»£å¸äº¤æ¢é›†æˆ
- âœ… å®æ—¶ä»·æ ¼ç›‘æ§
- âœ… æ™ºèƒ½å¤´å¯¸ç®¡ç†
- âœ… WebSocketå®æ—¶çŠ¶æ€æ¨é€

### ğŸ†• æ–°å¢æ¶æ„ç‰¹æ€§
- âœ… **OKXä»£ç†æœåŠ¡**: 8001ç«¯å£é€æ˜è½¬å‘
- âœ… **æœåŠ¡è§£è€¦**: ç­–ç•¥å¼•æ“ä¸ä¸»ç³»ç»Ÿç‹¬ç«‹
- âœ… **ä¸€é”®å¯åŠ¨**: è‡ªåŠ¨åŒ–æœåŠ¡ç®¡ç†
- âœ… **å¥åº·ç›‘æ§**: å®Œæ•´çš„æœåŠ¡çŠ¶æ€æ£€æŸ¥
- âœ… **æ—¥å¿—ç³»ç»Ÿ**: åˆ†æœåŠ¡æ—¥å¿—è®°å½•

### æŠ€æœ¯ç‰¹æ€§
- âœ… æ¨¡å—åŒ–æ¶æ„è®¾è®¡
- âœ… ä¾èµ–æ³¨å…¥å®¹å™¨
- âœ… TypeScript ç±»å‹å®‰å…¨
- âœ… WebSocket å®æ—¶é€šä¿¡
- âœ… è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
- âœ… ä»£ç†æœåŠ¡é€æ˜è½¬å‘

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Node.js >= 16.0.0
- npm >= 8.0.0
- BSC ç½‘ç»œè¿æ¥
- OKX API å¯†é’¥ (å¯é€‰)

## ğŸ› ï¸ å®‰è£…é…ç½®

1. **å…‹éš†é¡¹ç›®**
   ```bash
   git clone <repository-url>
   cd pancake
   ```

2. **å®‰è£…ä¾èµ–**
   ```bash
   npm install
   
   # å®‰è£…OKXä»£ç†æœåŠ¡ä¾èµ–
   cd okx-proxy && npm install
   ```

3. **é…ç½®ç¯å¢ƒå˜é‡**
   ```bash
   cp env.example .env
   # ç¼–è¾‘ .env æ–‡ä»¶é…ç½®ç›¸å…³å‚æ•°
   # ç¡®ä¿åŒ…å« OKX_SERVICE_URL=http://localhost:8001
   ```

4. **å¯åŠ¨ç³»ç»Ÿ**
   ```bash
   ./scripts/simple-start.sh
   ```

## ğŸ”„ OKXä»£ç†æœåŠ¡è¯¦è§£

### æœåŠ¡ç›®çš„
ä¸ºç­–ç•¥å¼•æ“æä¾›8001ç«¯å£çš„OKX APIè®¿é—®ï¼Œé€šè¿‡ä»£ç†è½¬å‘çš„æ–¹å¼å®ç°ç³»ç»Ÿæ¶æ„çš„ç‹¬ç«‹æ€§ã€‚

### å·¥ä½œåŸç†
- **ç›‘å¬ç«¯å£**: 8001
- **è½¬å‘ç›®æ ‡**: http://localhost:4000/api/okx/*
- **è½¬å‘è·¯å¾„**: æ‰€æœ‰ `/api/okx/*` è¯·æ±‚
- **æ—¥å¿—è®°å½•**: è¯¦ç»†çš„è¯·æ±‚è½¬å‘æ—¥å¿—

### ä½¿ç”¨æ–¹å¼
```bash
# ç­–ç•¥å¼•æ“è°ƒç”¨æ–¹å¼
curl http://localhost:8001/api/okx/health
curl -X POST http://localhost:8001/api/okx/quote -d '{"fromToken":"WBNB","toToken":"USDT","amount":"1"}'

# å¥åº·æ£€æŸ¥
curl http://localhost:8001/health
```

## ğŸ“š APIæ¥å£æ–‡æ¡£

### ğŸ”„ OKXäº¤æ¢API (é€šè¿‡ä»£ç†æœåŠ¡)
- `GET /api/okx/health` - OKXæœåŠ¡å¥åº·æ£€æŸ¥
- `POST /api/okx/quote` - è·å–äº¤æ¢æŠ¥ä»·
- `POST /api/okx/swap` - æ‰§è¡Œä»£å¸äº¤æ¢
- `POST /api/okx/approve` - ä»£å¸æˆæƒ
- `GET /api/okx/track/:orderId` - è¿½è¸ªäº¤æ˜“çŠ¶æ€

### ğŸ’§ æµåŠ¨æ€§ç®¡ç†API
- `POST /api/add-liquidity` - æ·»åŠ æµåŠ¨æ€§
- `GET /api/positions/:userAddress` - è·å–å¤´å¯¸
- `DELETE /api/positions/:tokenId` - å…³é—­å¤´å¯¸

### ğŸ” é’±åŒ…ç®¡ç†API
- `POST /api/wallet/unlock` - è§£é”é’±åŒ…
- `GET /api/wallet/info` - è·å–é’±åŒ…ä¿¡æ¯
- `POST /api/wallet/connect-web3` - è¿æ¥Web3

### ğŸ“Š ç­–ç•¥ç®¡ç†API
- `POST /api/strategy/create` - åˆ›å»ºç­–ç•¥
- `POST /api/strategy/:instanceId/start` - å¯åŠ¨ç­–ç•¥
- `GET /api/strategy/instances` - è·å–ç­–ç•¥åˆ—è¡¨

## ğŸ“š æ–‡æ¡£

- [é¡¹ç›®å¼€å‘è§„åˆ™](pancakeswap-project-guide.mdc)
- [OKXä»£ç†æœåŠ¡è¯´æ˜](okx-proxy/README.md)
- [ç­–ç•¥å¼•æ“APIé›†æˆé‡æ„æ€»ç»“](docs/ç­–ç•¥å¼•æ“APIé›†æˆé‡æ„æ€»ç»“.md)
- [ç³»ç»Ÿæ¶æ„æ–‡æ¡£](pancakeswap-architecture.mdc)

## ğŸ” æ•…éšœæ’æŸ¥

### æœåŠ¡çŠ¶æ€æ£€æŸ¥
```bash
# æ£€æŸ¥æ‰€æœ‰ç«¯å£çŠ¶æ€
./scripts/check-ports.sh

# å¥åº·æ£€æŸ¥
curl http://localhost:4000/health  # ä¸»ç³»ç»Ÿ
curl http://localhost:8001/health  # OKXä»£ç†
```

### æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹å„æœåŠ¡æ—¥å¿—
tail -f logs/backend.log      # ä¸»ç¨‹åºåç«¯
tail -f logs/okx-proxy.log    # OKXä»£ç†æœåŠ¡
tail -f logs/frontend.log     # å‰ç«¯æœåŠ¡
tail -f logs/strategy.log     # ç­–ç•¥ç®¡ç†
```

### ç«¯å£å†²çªè§£å†³
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :4000
lsof -i :8001

# åœæ­¢æ‰€æœ‰æœåŠ¡åé‡å¯
./scripts/stop-all-services.sh
./scripts/simple-start.sh
```

### å¸¸è§é—®é¢˜
1. **ä»£ç†è½¬å‘å¤±è´¥**: ç¡®è®¤ä¸»ç³»ç»Ÿ(4000ç«¯å£)å·²å¯åŠ¨
2. **ç­–ç•¥æ— æ³•è°ƒç”¨OKX**: æ£€æŸ¥8001ç«¯å£ä»£ç†æœåŠ¡çŠ¶æ€
3. **ç«¯å£å†²çª**: ä½¿ç”¨åœæ­¢è„šæœ¬åé‡æ–°å¯åŠ¨

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›é¡¹ç›®ã€‚

## ğŸ“„ è®¸å¯è¯

MIT License

---

**æ›´æ–°æ—¶é—´**: 2024å¹´12æœˆ  
**ç‰ˆæœ¬**: v2.1.0  
**ä¸»è¦å˜æ›´**: 
- âœ… æ–°å¢OKXä»£ç†æœåŠ¡ (8001ç«¯å£)
- âœ… ç³»ç»Ÿæ¶æ„è§£è€¦ä¼˜åŒ–
- âœ… ä¸€é”®å¯åŠ¨è„šæœ¬å®Œå–„
- âœ… å®Œæ•´çš„å¥åº·ç›‘æ§ä½“ç³» 